<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">



<title>Introduction to iml: Interpretable Machine Learning in R</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#header {
text-align: center;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; }  code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>

</head>

<body>




<h1 class="title toc-ignore">Introduction to iml: Interpretable Machine Learning in R</h1>



<p>Machine learning models usually perform really well for predictions, but are not interpretable. The iml package provides tools for analysing any black box machine learning model:</p>
<ul>
<li><p>Feature importance: Which were the most important features?</p></li>
<li><p>Feature effects: How does a feature influence the prediction? (Accumulated local effects, partial dependence plots and individual conditional expectation curves)</p></li>
<li><p>Explanations for single predictions: How did the feature values of a single data point affect its prediction? (LIME and Shapley value)</p></li>
<li><p>Surrogate trees: Can we approximate the underlying black box model with a short decision tree?</p></li>
<li><p>The iml package works for any classification and regression machine learning model: random forests, linear models, neural networks, xgboost, etc.</p></li>
</ul>
<p>This document shows you how to use the iml package to analyse machine learning models.</p>
<p>If you want to learn more about the technical details of all the methods, read chapters from: <a href="https://christophm.github.io/interpretable-ml-book/agnostic.html" class="uri">https://christophm.github.io/interpretable-ml-book/agnostic.html</a></p>
<div id="data-boston-housing" class="section level2">
<h2>Data: Boston Housing</h2>
<p>We’ll use the <code>MASS::Boston</code> dataset to demonstrate the abilities of the iml package. This dataset contains median house values from Boston neighbourhoods.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">data</span>(<span class="st">&quot;Boston&quot;</span>, <span class="dt">package  =</span> <span class="st">&quot;MASS&quot;</span>)</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="kw">head</span>(Boston)</a>
<a class="sourceLine" id="cb1-3" title="3"><span class="co">#&gt;      crim zn indus chas   nox    rm  age    dis rad tax ptratio  black</span></a>
<a class="sourceLine" id="cb1-4" title="4"><span class="co">#&gt; 1 0.00632 18  2.31    0 0.538 6.575 65.2 4.0900   1 296    15.3 396.90</span></a>
<a class="sourceLine" id="cb1-5" title="5"><span class="co">#&gt; 2 0.02731  0  7.07    0 0.469 6.421 78.9 4.9671   2 242    17.8 396.90</span></a>
<a class="sourceLine" id="cb1-6" title="6"><span class="co">#&gt; 3 0.02729  0  7.07    0 0.469 7.185 61.1 4.9671   2 242    17.8 392.83</span></a>
<a class="sourceLine" id="cb1-7" title="7"><span class="co">#&gt; 4 0.03237  0  2.18    0 0.458 6.998 45.8 6.0622   3 222    18.7 394.63</span></a>
<a class="sourceLine" id="cb1-8" title="8"><span class="co">#&gt; 5 0.06905  0  2.18    0 0.458 7.147 54.2 6.0622   3 222    18.7 396.90</span></a>
<a class="sourceLine" id="cb1-9" title="9"><span class="co">#&gt; 6 0.02985  0  2.18    0 0.458 6.430 58.7 6.0622   3 222    18.7 394.12</span></a>
<a class="sourceLine" id="cb1-10" title="10"><span class="co">#&gt;   lstat medv</span></a>
<a class="sourceLine" id="cb1-11" title="11"><span class="co">#&gt; 1  4.98 24.0</span></a>
<a class="sourceLine" id="cb1-12" title="12"><span class="co">#&gt; 2  9.14 21.6</span></a>
<a class="sourceLine" id="cb1-13" title="13"><span class="co">#&gt; 3  4.03 34.7</span></a>
<a class="sourceLine" id="cb1-14" title="14"><span class="co">#&gt; 4  2.94 33.4</span></a>
<a class="sourceLine" id="cb1-15" title="15"><span class="co">#&gt; 5  5.33 36.2</span></a>
<a class="sourceLine" id="cb1-16" title="16"><span class="co">#&gt; 6  5.21 28.7</span></a></code></pre></div>
</div>
<div id="fitting-the-machine-learning-model" class="section level2">
<h2>Fitting the machine learning model</h2>
<p>First we train a randomForest to predict the Boston median housing value:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1"><span class="kw">set.seed</span>(<span class="dv">42</span>)</a>
<a class="sourceLine" id="cb2-2" title="2"><span class="kw">library</span>(<span class="st">&quot;iml&quot;</span>)</a>
<a class="sourceLine" id="cb2-3" title="3"><span class="kw">library</span>(<span class="st">&quot;randomForest&quot;</span>)</a>
<a class="sourceLine" id="cb2-4" title="4"><span class="kw">data</span>(<span class="st">&quot;Boston&quot;</span>, <span class="dt">package  =</span> <span class="st">&quot;MASS&quot;</span>)</a>
<a class="sourceLine" id="cb2-5" title="5">rf =<span class="st"> </span><span class="kw">randomForest</span>(medv <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> Boston, <span class="dt">ntree =</span> <span class="dv">50</span>)</a></code></pre></div>
</div>
<div id="using-the-iml-predictor-container" class="section level2">
<h2>Using the iml Predictor() container</h2>
<p>We create a <code>Predictor</code> object, that holds the model and the data. The iml package uses R6 classes: New objects can be created by calling <code>Predictor$new()</code>.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1">X =<span class="st"> </span>Boston[<span class="kw">which</span>(<span class="kw">names</span>(Boston) <span class="op">!=</span><span class="st"> &quot;medv&quot;</span>)]</a>
<a class="sourceLine" id="cb3-2" title="2">predictor =<span class="st"> </span>Predictor<span class="op">$</span><span class="kw">new</span>(rf, <span class="dt">data =</span> X, <span class="dt">y =</span> Boston<span class="op">$</span>medv)</a></code></pre></div>
</div>
<div id="feature-importance" class="section level2">
<h2>Feature importance</h2>
<p>We can measure how important each feature was for the predictions with <code>FeatureImp</code>. The feature importance measure works by shuffling each feature and measuring how much the performance drops. For this regression task we choose to measure the loss in performance with the mean absolute error (‘mae’), another choice would be the mean squared error (‘mse’).</p>
<p>Once we create a new object of <code>FeatureImp</code>, the importance is automatically computed. We can call the <code>plot()</code> function of the object or look at the results in a data.frame.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1">imp =<span class="st"> </span>FeatureImp<span class="op">$</span><span class="kw">new</span>(predictor, <span class="dt">loss =</span> <span class="st">&quot;mae&quot;</span>)</a>
<a class="sourceLine" id="cb4-2" title="2"><span class="kw">plot</span>(imp)</a></code></pre></div>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASAAAAEgCAMAAAAjXV6yAAAAElBMVEUAAAAvT08zMzNNTU3r6+v///96k8mbAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAIW0lEQVR4nO2di4KrKAyGmWV9/1fe7QVMuJhAvFD4c+aMraO/5itISGPrNtihuadPYHQDIMEASDAAEgyABAMgwU4A9C8x9uR4bcOmTwgAEADZBAAIgGwCKwJyL9MKNALy2YP90V3+WQWcSwgBEFvrXErobEDev/6zX88C+msxt9vBVhZA9CcsAIgD2iKW8Pyf/02ncIFdACg/SGMX+z7waEEFQMN1sSYBAkgl0A5ovGtQm8A9o1gcyvz2/CjWKHBpHHRkN/lnF7gykp4CUNOmAARANgEAAiCbAAABkE3gtwG9IxoAqq7NYuILzuCXAeWzqgvOoBeQ//4judcrTq+4tilxUc9nXAzoPVl9/wBQuQXRrMe9GcUzADUf1AjoZWhBowD6WiE3eMEZ/DCg0Uex5wEhDhLXIpJ+XgCAAMgmAEAAZBMAIACyCTwCSF86YPbPLPAEIB4AA1C6NplCzQYolHPsxVON1R3pJHw6QGlxUOtkdXpAGwUUqoMaMooEkPaYI5gR0MuUL8paLQhd7BhQz0V6/lEs1gD3jWKIg+TTQyQ9jn9mAQACIJsAAAGQTQCAAMgm0A2I1U41AUreLp4YUGLKY6ZvqE8JyMfqu+bZfFaSMSMgT/NmTbN5WvV0i39mgV5AKR0AKgNqzShSQC1HfN56AaGLVQB1XoMKhYUzAsIo1mXKYy4RB1kArRJJ9wO61T+zAAABkE0AgADIJgBAAGQT6AbUnTBDHCQcc+5I2vtQ1uG3vpt6556LhTyHD4vmm3onn83vHw64Id3RBEhdozh5RhEtSAEoLVAEIEZo/xjOziLOuUexQ1Mec+446ARAiKSH8s8sAEAAZBMAIACyCQAQANkE9IB8+izNKQrHTMKfm/wzCxgAtbWgNIC+yT+zQAHQKxNBkxGefj77tn/dSLwpSgMom4Ld5J9ZIAfkPj/7ClIKVJrJKyarf4W6qZv8MwvUAJEVeUUiAB0Bil83QgEdZxT/frc0MRq/Bjl+DUp5rN2CMssbTCugw888/DlAGSofv2okdLEtvt+z4iiWESqEPEU7PuY8cVB2MT0H0MSR9EmAnvHPLKAApLUh/TML5IC645Uh/TML5IDKzwEodRct6LsAoM5rUDMfTRx0v39mAWWDEbNlEqBqnPh7gJxMrB1Qfabxa4AqaQkfp2T0XrFNe7/YwVz11wBVmg6/xzBNLK4FqLiCIUkWLxNK8H4/X5YnzHSAFu1iLmtRVUALdrEsJ50B8nyhADTRKCYC2nOJDV1srjio2McUdnzMiSLp9xurmM23TTUA6OC9eQDigLL35gGoBAj5IADSbZoDyt6bB6AEUK8dHfMTBS0DqDlhFua/9/tnFkgANd1XpwZ0MBP7SUASpVil+C33kAAdzeWnBJTddAhAOaCw0HxM4AT5xA5A3nttumOqFqR6sRfuYjqLgHQX6ZlGMSWg7yjmlYAmioMsdnTMxSLpdkCP+WcWACAAsgkAEADZBAAIgGwCtwAKUTQAlY8Z5xkAVDzmPhNbApCnlYqa+8VoguB+/8wCrYCyKiEx3bEYoG1L0kHiTb1T5BPbuhgB5Ekfq7woi7WgcpErABUAaa9BK45ivmUUWzcOSt9frR9zwUia9S0R0IP+mQU6AbG+BUA6G9I/swAAAZBNAIAAyCagBOTZIltfBJS/Gw9AVL1QrzA1oP2z2kPGLJ2wcvVSRcfMgPY7eje+qMzFijVBMwNirYU8In2MqS8MaM+YEUBZRnGSPOJuakBpW0IX+4CoXoMqF+nlAPFRLBSSs7QHV19sFNNYor5WHNQBaK1IugfQEP6ZBQAIgGwCAARANgEAAiCbgB3QUT7oef/MAlcBKsTRywAiU7HqN/WWZmLrAOKT+RKg4lx+HUD7slYfBEC8Ei/LKE6XT2wGlBZxvozQRwvCNUgAlFTipYDWHsVqxtRXjoNUgBBJS4AG8c8sAEAAZBMAIACyCQDQM4BKg/wigLIqvBKgYpgIQNHKE43pAYV6DlqjWPwMs8pUdXZA8S5MsT5oYUAbSwEROixhNmG6rAPQwccEogWxXCK6GAGkrFFcfBRLShXj34n4ynFQ3aj6wpG0DtAw/pkFAAiAbAIABEA2AQACIJvANYDKYRAABasE0gD0tdpUbClAoYCqMBerTuaXArTR9CIAVfiUS/CmTCi2A/LhF1oQAPUA2tOtBynXAfwzC3QD4mXADBDioLIRcUTSAqBx/DMLABAA2QQACIBsAicColb/wkPLphfJqjYFIMEASDAAEmymzMQlBkCCAZBg5wKq1wrnm+YfbX7Cpg3nwL4bpG5nAmpxhCVMTtt0Y5VdsqzCHmtBbVvrW5u+Bek2exDQBa2iCZCuwT8H6BKY/vRzeO4ifYVw2+VqaECNKLWAlENTg+xcgFqURwekf6kvioOUsoikBQMgwQBIMAASDIAEAyDBAEiw6wC11ZqZz8N1aci7XAio6XjCeagc6fFF3AeArBt0W1T+dLRPf3v9ctvXHRf+Fle8f76Pwi7vZ87RZ1GU7f/Vc+yY+9k4rhoVtG6cbo4so+PhhX77Eh+SFV9s4a8fj5iAIzps/2SdI7+JODkRsrvsxvnm4kseT5MD2hIHUx8dW58/KwCiG3HfaLMdBVBYOtbHOKA40ImAiEBsFnx/ukvaw9KD8tdP48b55tiy0MXY0eUWxHZz/BjpLjmivQURHS5x7Mb5xk/t/i7myF/H7mLbFoau6D65QBe72H6R5t6y9uSS/TNt2tgYICI+ACDS2oPjLrZxPszvPvJh/ovMRdJxR8UwnwMMZ7F3SI0bI1nPSXU6Iu4GQNfoXmv3AZL3GhLQSAZAggGQYAAkGAAJBkCCAZBgACQYAAn2H6xtdNEISMPrAAAAAElFTkSuQmCC" /><!-- --></p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1">imp<span class="op">$</span>results</a>
<a class="sourceLine" id="cb5-2" title="2"><span class="co">#&gt;    feature importance.05 importance importance.95 permutation.error</span></a>
<a class="sourceLine" id="cb5-3" title="3"><span class="co">#&gt; 1    lstat     3.5151359   4.676265      5.437770          4.608501</span></a>
<a class="sourceLine" id="cb5-4" title="4"><span class="co">#&gt; 2       rm     3.1371920   3.431800      4.718858          3.382070</span></a>
<a class="sourceLine" id="cb5-5" title="5"><span class="co">#&gt; 3      nox     1.6552825   1.747307      1.810610          1.721987</span></a>
<a class="sourceLine" id="cb5-6" title="6"><span class="co">#&gt; 4      dis     1.5567997   1.686769      1.738094          1.662326</span></a>
<a class="sourceLine" id="cb5-7" title="7"><span class="co">#&gt; 5     crim     1.5783742   1.685566      1.756046          1.661141</span></a>
<a class="sourceLine" id="cb5-8" title="8"><span class="co">#&gt; 6  ptratio     1.3369138   1.479399      1.535624          1.457961</span></a>
<a class="sourceLine" id="cb5-9" title="9"><span class="co">#&gt; 7    indus     1.3836497   1.470185      1.500201          1.448881</span></a>
<a class="sourceLine" id="cb5-10" title="10"><span class="co">#&gt; 8      tax     1.3379611   1.412848      1.469469          1.392375</span></a>
<a class="sourceLine" id="cb5-11" title="11"><span class="co">#&gt; 9      age     1.2917620   1.362113      1.449696          1.342375</span></a>
<a class="sourceLine" id="cb5-12" title="12"><span class="co">#&gt; 10   black     1.1216054   1.152142      1.264655          1.135446</span></a>
<a class="sourceLine" id="cb5-13" title="13"><span class="co">#&gt; 11     rad     1.0612629   1.090473      1.094276          1.074671</span></a>
<a class="sourceLine" id="cb5-14" title="14"><span class="co">#&gt; 12    chas     0.9730407   1.044441      1.069104          1.029306</span></a>
<a class="sourceLine" id="cb5-15" title="15"><span class="co">#&gt; 13      zn     0.9521757   1.031062      1.138586          1.016121</span></a></code></pre></div>
</div>
<div id="feature-effects" class="section level2">
<h2>Feature effects</h2>
<p>Besides knowing which features were important, we are interested in how the features influence the predicted outcome. The <code>FeatureEffect</code> class implements accumulated local effect plots, partial dependence plots and individual conditional expectation curves. The following plot shows the accumulated local effects (ALE) for the feature ‘lstat’. ALE shows how the prediction changes locally, when the feature is varied. The marks on the x-axis indicates the distribution of the ‘lstat’ feature, showing how relevant a region is for interpretation (little or no points mean that we should not over-interpret this region).</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1">ale =<span class="st"> </span>FeatureEffect<span class="op">$</span><span class="kw">new</span>(predictor, <span class="dt">feature =</span> <span class="st">&quot;lstat&quot;</span>)</a>
<a class="sourceLine" id="cb6-2" title="2">ale<span class="op">$</span><span class="kw">plot</span>()</a>
<a class="sourceLine" id="cb6-3" title="3"><span class="co">#&gt; Warning in grid.Call.graphics(C_segments, x$x0, x$y0, x$x1, x$y1, x$arrow):</span></a>
<a class="sourceLine" id="cb6-4" title="4"><span class="co">#&gt; semi-transparency is not supported on this device: reported only once per</span></a>
<a class="sourceLine" id="cb6-5" title="5"><span class="co">#&gt; page</span></a></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>If we want to compute the partial dependence curves on another feature, we can simply reset the feature:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1">ale<span class="op">$</span><span class="kw">set.feature</span>(<span class="st">&quot;rm&quot;</span>)</a>
<a class="sourceLine" id="cb7-2" title="2">ale<span class="op">$</span><span class="kw">plot</span>()</a>
<a class="sourceLine" id="cb7-3" title="3"><span class="co">#&gt; Warning in grid.Call.graphics(C_segments, x$x0, x$y0, x$x1, x$y1, x$arrow):</span></a>
<a class="sourceLine" id="cb7-4" title="4"><span class="co">#&gt; semi-transparency is not supported on this device: reported only once per</span></a>
<a class="sourceLine" id="cb7-5" title="5"><span class="co">#&gt; page</span></a></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
</div>
<div id="measure-interactions" class="section level2">
<h2>Measure interactions</h2>
<p>We can also measure how strongly features interact with each other. The interaction measure regards how much of the variance of <span class="math inline">\(f(x)\)</span> is explained by the interaction. The measure is between 0 (no interaction) and 1 (= 100% of variance of <span class="math inline">\(f(x)\)</span> due to interactions). For each feature, we measure how much they interact with any other feature:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1">interact =<span class="st"> </span>Interaction<span class="op">$</span><span class="kw">new</span>(predictor)</a>
<a class="sourceLine" id="cb8-2" title="2"><span class="kw">plot</span>(interact)</a></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>We can also specify a feature and measure all it’s 2-way interactions with all other features:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1">interact =<span class="st"> </span>Interaction<span class="op">$</span><span class="kw">new</span>(predictor, <span class="dt">feature =</span> <span class="st">&quot;crim&quot;</span>)</a>
<a class="sourceLine" id="cb9-2" title="2"><span class="kw">plot</span>(interact)</a></code></pre></div>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASAAAAEgCAMAAAAjXV6yAAAAD1BMVEUAAAAzMzNNTU3r6+v///+EK80uAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAIvklEQVR4nO2djZabIBSEqeX9n7lNovzLABcEdeb0rJuMN4EvgHFis0pTWanZDVhdBAREQEAEBERAQAQENBTQ30P2t5Ty7qRiAgIuAQGXgIBLQMAlIOASEHAHANoIqFaT+9hSrJTarVpAm96+Q2T7bH6/aXP74+pNHz/uC0ipg1A9oF/XfzS8f9/Ndmy2zRKa0kdJsVKGUMMIcoHsw8kMl5Cb1n/+yxSre8nt9zBAH80YBKLiHdDXkgEyGJ4FSLQGuYDsIp3idmNAoqPYMbfsUczcfg4ga9UCatHkPoqKCQi4BARcAgIuAQGXgIBLQMAlIOASEHAJCLgDADFyrdbkPoqKqwFtR+LqnKLa+2dFrubku+2xOwJyTtejVGhe5Grjm7bH7jzFPDIrBGZOANj22J2nmDtgjjm2QiZd8RrXq36K+csMR1AEyBlIKXCXJoorrUHbb/XdoqB1auS6zlEsGExlkjdzXnEjIDu3COiE0FbO55WAqjS5j6JiAgIuAQGXgIBLQMAlIOASEHArAW3RL/H7xVdHriWAYk3uo6i4AdC2HVcHmR96QuQanJ+uA8g7WY9uXBa5hgnHUoC0G5DNiVyjjGwdQNqNgDCgsZFrWat7qGqRDqeY5ghyACXWII/MRYniumvQPsW2I32Nw9drItc1j2JtkjdzXjEBAZeAgEtAwCUg4BIQcAkIuAQEXAICLgEBl4CA2wzIiwxDh4Bqru0YFXe0F9e4bYA2EzpPugw4vqRsKUBO+Dwnk05clLgaoDDymRK51rRZqkZAk7554T4jSPs/L0sUb7YG+cyuCu3bi2vcJkDhUWxKJn1RcRugSk3uo6iYgIBLQMAlIOASEHAJCLgEBFwCAi4BAZeAgFsIaMvcyu/7EkAIQV4d+xidpNYUt7iFgH4x6heMc6KqL49c45ijorjJrQBkz9ITucY1kWsiKCsvbnNrRtDJ5tjh2IyPXPNtHaNGQBdHrvcbQcHP4YHZ0muQ7bu/CciMTRSXPoqZSeVvXhe5qu9imgdWp8l9FBXHgNTOiIB+VgqQIiBrJQFpAjJWBOi7AHENMlYMqL8m91FUTEDATQDiFPOsCJAyBzIC+sujGHSrAeE08fGRaz5zqY1bHwjoFM0Rqm721rWR6+mpfElxoxsDys0tP+S4OnI9D4MKilvdBJYTQn4kprWfaFwQmGXiRFzccwSdBL8BoP1rbq//A2zpl2+48PNGCK6OXFcZQTlAqWj6ush1kTXodCh7oarzpbfXRa5rHMVKR1SF5M2cV3wKhKcau0VAeTfmMeBoOrmPouIY0ABN7qOoOAak+hOb3EdRcQhoyDvWyX0UFYeAhky2yX0UFZ9i4QjarZgHp5hnRYBU94/mHwkoJrSFt87C16dn0sWAylXXzLZryK58Jx3Msc390kRtvwPYnsNrrftl0qehxiqA9PeDVed2/vrf3pn0eSy2DKBQYTYWAzI/+0Wu582ZpMxn8wEg8x3AZYA+qnkd1x9B0Wfz0TyqGkG1gNZfg6KjWDxgTgB1yqSXP4pFgMz3/x5TTKe+A/hFlwEHq2TVW56kJvdRVJwAFIqACKgc0Jj3H5P7KCpOAepOaXIfRcUEBFwCAi4BATcExE81QssHNEaT+ygqlgOK3iY9PXIVA4pV0czmS6QWAmSDV+3khn0i1/aL7FYC5McaPSPX7GWI9wFkt4Mi1/K2XKdaQPaPr/VMFJ8zgvwAsRugh6xBPoi+keszjmJaO1cBH1jeE7n21+Q+iooJCLgEBFwCAi4BAZeAgEtAwCUg4BIQcAkIuIWANm8T3Q/um9xHUfEAQLEm91FUXAwouBDInpz2jlz791FUXAoovKjMbILbHSLX7n0UFRePIG+0OOPG2cHbryXuyAaKtwFkw9YiQA2ZdL4pk1QMKBxL/vL93hF0ugY5mbQ8cr3zGuQdxTY/Yu0Xud72KCbT5D6KigkIuAQEXAICLgEBl4CAS0DAJSDgEhBwCQi4TYDyOeIrI9caQLEm91FU3ALIfLXAfqmQvVMQuX5yoEF9FBW3AErlGtLINRt0CPsoKm4FdGw6/fmsfFQm7KOouBnQkC+7rWnExRJNMc0RdALILtLSyPVha9B+FNs/QuwSuT7qKFaryX0UFRMQcAkIuAQEXAICLgEBl4CAS0DAJSDgEhBwCQi4AwAxk65WSUOedrK62fh5v0OWST8r7tBH4mH/U68wk35YYKYrEsVXRq6akevVgB64BiUASTLpBx7Fwk8N+c0L7ZrcR1ExAQGXgIBLQMAlIOASEHAJCLgEBFwCAi4BAXcAIEau1TppSHj+/ihAx38OF/x9sSjheBQg7SWsLZFrnJE9DJCTbpifDZFr/QszR9UNdS/d1BlAHyVfqaePIDGgh69BXtDqkSlPFF9xFGPk2kOT+ygqJiDgEhBwCQi4BARcAgIuAQH3EkBGf/AuKxZ/REBABAREQEC3yWVmiYCACAhoMKAtCPcbixMfKQ19ZkdjAUXBWmNxA1zJM7u6BaCGHvrPR0DZYgmfVwCS8HkDIBGfFwCS8SEgpEveB9mPhxqLm98Hbb8PqpY9ij1ABAREQEAEBERAQAQEREBAUwChS/DU0a7S1jX3AhfOAPShkyWUAJTZXeXcoqfJaQKgH5vKlucBtZnLAjo2B6jfhPvcVsevdgSpfcAl9zvuVdqWmrH5Nb6mW/t70v1B3N3zrb1SBtCv4fpAsjdWBYCUe1dqP38Hb3oq5xHcB1PObwDBdEC28doOKW8Ene7n3qH83XX8CP5D+I+JW3ulIkC/2bGPfeUwCDoT7uc+UAKQO1ud2lsBUs5CuQ/4/Ajy9ssD0mZ18p7zDoCOzlgio6aYB+g2I8h5H2SGjNPcHCB/P2/9tu4JIH+tdh8p39gxDPIy76QPTOZF/jU9BUil9lMHKvOY7nxSZhZ7taYB9giaa2vXnt9IpR1/JSA8bvx936eK/6/2TkAVIiAgAgIiICACAiIgIAICIiAgAgL6BxcpTB9VFx1vAAAAAElFTkSuQmCC" /><!-- --></p>
</div>
<div id="surrogate-model" class="section level2">
<h2>Surrogate model</h2>
<p>Another way to make the models more interpretable is to replace the black box with a simpler model - a decision tree. We take the predictions of the black box model (in our case the random forest) and train a decision tree on the original features and the predicted outcome. The plot shows the terminal nodes of the fitted tree. The maxdepth parameter controls how deep the tree can grow and therefore how interpretable it is.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1">tree =<span class="st"> </span>TreeSurrogate<span class="op">$</span><span class="kw">new</span>(predictor, <span class="dt">maxdepth =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb10-2" title="2"><span class="kw">plot</span>(tree)</a></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>We can use the tree to make predictions:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1"><span class="kw">head</span>(tree<span class="op">$</span><span class="kw">predict</span>(Boston))</a>
<a class="sourceLine" id="cb11-2" title="2"><span class="co">#&gt; Warning in self$predictor$data$match_cols(data.frame(newdata)): Dropping</span></a>
<a class="sourceLine" id="cb11-3" title="3"><span class="co">#&gt; additional columns: medv</span></a>
<a class="sourceLine" id="cb11-4" title="4"><span class="co">#&gt;     .y.hat</span></a>
<a class="sourceLine" id="cb11-5" title="5"><span class="co">#&gt; 1 27.09989</span></a>
<a class="sourceLine" id="cb11-6" title="6"><span class="co">#&gt; 2 27.09989</span></a>
<a class="sourceLine" id="cb11-7" title="7"><span class="co">#&gt; 3 27.09989</span></a>
<a class="sourceLine" id="cb11-8" title="8"><span class="co">#&gt; 4 27.09989</span></a>
<a class="sourceLine" id="cb11-9" title="9"><span class="co">#&gt; 5 27.09989</span></a>
<a class="sourceLine" id="cb11-10" title="10"><span class="co">#&gt; 6 27.09989</span></a></code></pre></div>
</div>
<div id="explain-single-predictions-with-a-local-model" class="section level2">
<h2>Explain single predictions with a local model</h2>
<p>Global surrogate model can improve the understanding of the global model behaviour. We can also fit a model locally to understand an individual prediction better. The local model fitted by <code>LocalModel</code> is a linear regression model and the data points are weighted by how close they are to the data point for wich we want to explain the prediction.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1">lime.explain =<span class="st"> </span>LocalModel<span class="op">$</span><span class="kw">new</span>(predictor, <span class="dt">x.interest =</span> X[<span class="dv">1</span>,])</a>
<a class="sourceLine" id="cb12-2" title="2"><span class="co">#&gt; Loading required package: glmnet</span></a>
<a class="sourceLine" id="cb12-3" title="3"><span class="co">#&gt; Loading required package: Matrix</span></a>
<a class="sourceLine" id="cb12-4" title="4"><span class="co">#&gt; Loading required package: foreach</span></a>
<a class="sourceLine" id="cb12-5" title="5"><span class="co">#&gt; Loaded glmnet 2.0-16</span></a>
<a class="sourceLine" id="cb12-6" title="6"><span class="co">#&gt; Loading required package: gower</span></a>
<a class="sourceLine" id="cb12-7" title="7">lime.explain<span class="op">$</span>results</a>
<a class="sourceLine" id="cb12-8" title="8"><span class="co">#&gt;               beta x.recoded    effect x.original feature feature.value</span></a>
<a class="sourceLine" id="cb12-9" title="9"><span class="co">#&gt; rm       4.4836483     6.575 29.479987      6.575      rm      rm=6.575</span></a>
<a class="sourceLine" id="cb12-10" title="10"><span class="co">#&gt; ptratio -0.5244767    15.300 -8.024493       15.3 ptratio  ptratio=15.3</span></a>
<a class="sourceLine" id="cb12-11" title="11"><span class="co">#&gt; lstat   -0.4348698     4.980 -2.165652       4.98   lstat    lstat=4.98</span></a>
<a class="sourceLine" id="cb12-12" title="12"><span class="kw">plot</span>(lime.explain)</a></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1">lime.explain<span class="op">$</span><span class="kw">explain</span>(X[<span class="dv">2</span>,])</a>
<a class="sourceLine" id="cb13-2" title="2"><span class="kw">plot</span>(lime.explain)</a></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
</div>
<div id="explain-single-predictions-with-game-theory" class="section level2">
<h2>Explain single predictions with game theory</h2>
<p>An alternative for explaining individual predictions is a method from coalitional game theory named Shapley value. Assume that for one data point, the feature values play a game together, in which they get the prediction as a payout. The Shapley value tells us how to fairly distribute the payout among the feature values.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" title="1">shapley =<span class="st"> </span>Shapley<span class="op">$</span><span class="kw">new</span>(predictor, <span class="dt">x.interest =</span> X[<span class="dv">1</span>,])</a>
<a class="sourceLine" id="cb14-2" title="2">shapley<span class="op">$</span><span class="kw">plot</span>()</a></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>We can reuse the object to explain other data points:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" title="1">shapley<span class="op">$</span><span class="kw">explain</span>(<span class="dt">x.interest =</span> X[<span class="dv">2</span>,])</a>
<a class="sourceLine" id="cb15-2" title="2">shapley<span class="op">$</span><span class="kw">plot</span>()</a></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>The results in data.frame form can be extracted like this:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" title="1">results =<span class="st"> </span>shapley<span class="op">$</span>results</a>
<a class="sourceLine" id="cb16-2" title="2"><span class="kw">head</span>(results)</a>
<a class="sourceLine" id="cb16-3" title="3"><span class="co">#&gt;   feature         phi     phi.var feature.value</span></a>
<a class="sourceLine" id="cb16-4" title="4"><span class="co">#&gt; 1    crim -0.06868930 0.792192278  crim=0.02731</span></a>
<a class="sourceLine" id="cb16-5" title="5"><span class="co">#&gt; 2      zn -0.01817100 0.009751350          zn=0</span></a>
<a class="sourceLine" id="cb16-6" title="6"><span class="co">#&gt; 3   indus -0.27535622 0.560263978    indus=7.07</span></a>
<a class="sourceLine" id="cb16-7" title="7"><span class="co">#&gt; 4    chas -0.01451767 0.007715022        chas=0</span></a>
<a class="sourceLine" id="cb16-8" title="8"><span class="co">#&gt; 5     nox  0.45028775 1.436987974     nox=0.469</span></a>
<a class="sourceLine" id="cb16-9" title="9"><span class="co">#&gt; 6      rm -0.02257657 4.960426774      rm=6.421</span></a></code></pre></div>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
